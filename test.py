import json
import unittest
from app import app

test_data = {
    'GaoMingfei': {
        'name': '高鸣飞',
        'descriptors': [
            [-0.12735453248023987, 0.1120358482003212, 0.006890706717967987, -0.04667782783508301, -0.05271003767848015, -0.052237726747989655, -0.12257617712020874, -0.13681627810001373, 0.0696803629398346, -0.03131818398833275, 0.1565030813217163, -0.08398781716823578, -0.19210270047187805, -0.09812358021736145, -0.038236282765865326, 0.18930871784687042, -0.18710099160671234, -0.13971467316150665, -0.03580265864729881, -0.01676933839917183, 0.09032060205936432, 0.024227473884820938, -0.05083131045103073, 0.06298862397670746, -0.12045513093471527, -0.2748155891895294, -0.084427610039711, -0.10878638923168182, 0.02325327880680561, 0.003885331330820918, -0.08633449673652649, 0.03445601463317871, -0.1812843382358551, -0.07331494241952896, 0.10395850241184235, 0.11648087948560715, 0.030223423615098, -0.039689723402261734, 0.1660594493150711, 0.01003651786595583, -0.23944313824176788, 0.06651970744132996, 0.13450947403907776, 0.251018226146698, 0.21475054323673248, 0.0015843547880649567, 0.04714546352624893, -0.08880668878555298, 0.15097996592521667, -0.15064293146133423, 0.05370917171239853, 0.15320786833763123, 0.12982076406478882, 0.09450226277112961, 0.041880957782268524, -0.15800563991069794, 0.01782028004527092, 0.14402861893177032, -0.1347675770521164, 0.09086059033870697, 0.08879981935024261, -0.07080966234207153, -0.04025272652506828, -0.0649493858218193,
                0.17532378435134888, 0.09678778052330017, -0.12231126427650452, -0.23947535455226898, 0.09716019779443741, -0.1343809962272644, -0.13214688003063202, 0.09831223636865616, -0.1712014526128769, -0.13893774151802063, -0.3571034073829651, -0.004861378110945225, 0.41632717847824097, 0.10527870059013367, -0.23214884102344513, 0.09689468145370483, 0.011893252842128277, -0.03763621300458908, 0.16172784566879272, 0.16906720399856567, 0.016253778710961342, 0.06505484133958817, -0.037450067698955536, -0.013435129076242447, 0.276069313287735, -0.0033087534829974174, -0.05601450800895691, 0.17199239134788513, -0.02916289120912552, 0.07795052975416183, 0.016378091648221016, 0.04172208160161972, -0.032083190977573395, -0.056769780814647675, -0.12441711872816086, -0.08417323231697083, 0.01617586985230446, -0.03588220477104187, -0.011720210313796997, 0.11588464677333832, -0.16400031745433807, 0.11066277325153351, 0.028932929039001465, 0.08504874259233475, -0.05685800313949585, 0.031035326421260834, -0.06006499379873276, 0.04554665461182594, 0.14324511587619781, -0.1959390789270401, 0.2489423155784607, 0.15654508769512177, 0.050160832703113556, 0.03735877573490143, 0.13213226199150085, 0.011208665557205677, 0.023907113820314407, -0.011674506589770317, -0.16859085857868195, -0.07730142027139664, 0.07940100878477097, -0.0337616503238678, 0.1347191035747528, 0.0074040647596120834]
        ]
    }
}


class TestApp(unittest.TestCase):

    def setUp(self):
        app.testing = True
        self.client = app.test_client()

    def test_get_face_db(self):
        response = self.client.get('/api/face-db')
        data = json.loads(response.data)
        self.assertTrue(data.get('GaoMingfei'))

    def test_post_face_db(self):
        response = self.client.post('/api/face-db', data=json.dumps(test_data))
        data = json.loads(response.data)
        self.assertTrue(data.get('success'))

    def test_put_face_db(self):
        response = self.client.put('/api/face-db', data=json.dumps(test_data))
        data = json.loads(response.data)
        self.assertTrue(data.get('success'))
        response = self.client.get('/api/face-db')
        data = json.loads(response.data)
        self.assertTrue(len(data['GaoMingfei']['descriptors']) > 1)

    def test_put_face_db_with_wrong_format_data(self):
        _test_data = test_data.copy()
        _test_data['GaoMingfei']['descriptors'] = '?'
        response = self.client.put('/api/face-db', data=json.dumps(_test_data))
        data = json.loads(response.data)
        self.assertFalse(data.get('success'))
        self.assertTrue(data.get('message').endswith('array'))


if __name__ == "__main__":
    unittest.main()
